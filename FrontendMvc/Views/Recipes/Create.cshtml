@model FrontendMvc.Models.Recipes.RecipeViewModel

@{
    ViewData["Title"] = "Yeni Tarif Ekle";
    var categories = ViewBag.Categories as List<FrontendMvc.Models.Recipes.CategoryViewModel> ?? new();
}

@section Styles {
    <link rel="stylesheet" href="~/css/recipe-form.css" />
}

<div class="recipe-create-container">
    <div class="row">
        <div class="col-12">
            <div class="bd bgc-white p-20 recipe-create-container">
                <div class="layers">
                    <div class="layer w-100 mB-15">
                        <div class="peers fxw-nw ai-c">
                            <div class="peer peer-greed">
                                <h4 class="lh-1 mB-0">
                                    <i class="ti-plus mR-10"></i> Yeni Tarif Ekle
                                </h4>
                            </div>
                        </div>
                    </div>

                    <div class="layer w-100 mB-15">
                        <form asp-action="Create" method="post" enctype="multipart/form-data" id="createRecipeForm">
                            <!-- HÄ±zlÄ± Bilgi Ã‡ubuÄŸu -->
                            <div class="layer w-100 mB-5">
                                <div class="quick-info-bar">
                                    <div class="quick-info-item">
                                        <div class="form-check">
                                            <input asp-for="IsFeatured" class="form-check-input" type="checkbox" id="IsFeaturedTop" />
                                            <label class="form-check-label" for="IsFeaturedTop">
                                                <i class="ti-star mR-5"></i> Ã–ne Ã‡Ä±kan
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quick-info-item">
                                        <label asp-for="PrepTimeMinutes" class="mB-0">
                                            <i class="ti-timer mR-5"></i> HazÄ±rlÄ±k (dk):
                                        </label>
                                        <input asp-for="PrepTimeMinutes" class="form-control form-control-sm d-inline-block" type="number" min="0" placeholder="0" />
                                    </div>
                                    <div class="quick-info-item">
                                        <label asp-for="CookingTimeMinutes" class="mB-0">
                                            <i class="ti-time mR-5"></i> PiÅŸirme (dk) *:
                                        </label>
                                        <input asp-for="CookingTimeMinutes" class="form-control form-control-sm d-inline-block" type="number" min="1" required placeholder="30" />
                                        <span asp-validation-for="CookingTimeMinutes" class="text-danger fsz-xs"></span>
                                    </div>
                                    <div class="quick-info-item">
                                        <label asp-for="Servings" class="mB-0">
                                            <i class="ti-user mR-5"></i> KaÃ§ KiÅŸilik:
                                        </label>
                                        <input asp-for="Servings" class="form-control form-control-sm d-inline-block" type="number" min="1" placeholder="4" style="width: 60px; min-width: 60px; max-width: 60px; text-align: center;" />
                                    </div>
                                    <div class="quick-info-item">
                                        <label asp-for="Difficulty" class="mB-0">
                                            <i class="ti-settings mR-5"></i> Zorluk:
                                        </label>
                                        <select asp-for="Difficulty" class="form-control form-control-sm d-inline-block">
                                            <option value="Kolay">ðŸŸ¢ Kolay</option>
                                            <option value="Orta" selected>ðŸŸ¡ Orta</option>
                                            <option value="Zor">ðŸ”´ Zor</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <!-- Sol Kolon -->
                                <div class="col-lg-6 col-md-6">
                                    <div class="layers">
                                        <div class="layer w-100 mB-15">
                                            <label asp-for="Title" class="form-label fw-600">
                                                <i class="ti-bookmark mR-5"></i> Tarif AdÄ± *
                                            </label>
                                            <input asp-for="Title" class="form-control" required placeholder="Ã–rn: Tavuklu Pilav" />
                                            <span asp-validation-for="Title" class="text-danger fsz-sm"></span>
                                        </div>

                                        <div class="layer w-100 mB-15">
                                            <label asp-for="Ingredients" class="form-label fw-600">
                                                <i class="ti-shopping-cart mR-5"></i> Malzemeler *
                                            </label>
                                            <div style="margin-top:22px;"></div>
                                            <div id="ingredientsEditor"></div>
                                            <textarea asp-for="Ingredients" id="Ingredients" name="Ingredients" class="d-none" required></textarea>
                                            <span asp-validation-for="Ingredients" class="text-danger fsz-sm"></span>
                                        </div>

                                        <div class="layer w-100 mB-20">
                                            <label asp-for="Description" class="form-label fw-600">
                                                <i class="ti-file-text mR-5"></i> KÄ±sa AÃ§Ä±klama
                                            </label>
                                            <textarea asp-for="Description" class="form-control" rows="2" placeholder="Tarif hakkÄ±nda kÄ±sa bir aÃ§Ä±klama yazÄ±n"></textarea>
                                            <span asp-validation-for="Description" class="text-danger fsz-sm"></span>
                                        </div>

                                        <div class="layer w-100 mB-15">
                                            <label asp-for="Tips" class="form-label fw-600">
                                                <i class="ti-light-bulb mR-5"></i> PÃ¼f NoktalarÄ±
                                            </label>
                                            <textarea asp-for="Tips" class="form-control" rows="3"
                                                      placeholder="PÃ¼f noktalarÄ±"></textarea>
                                        </div>

                                    </div>
                                </div>

                                <!-- SaÄŸ Kolon -->
                                <div class="col-lg-6 col-md-6">
                                    <div class="layers">
                                        <div class="layer w-100 mB-15">
                                            <label asp-for="CategoryId" class="form-label fw-600">
                                                <i class="ti-folder mR-5"></i> Kategori
                                            </label>
                                            <select asp-for="CategoryId" class="form-control">
                                                <option value="">Kategori SeÃ§in</option>
                                                @foreach (var category in categories)
                                                {
                                                    <option value="@category.Id">@category.Name</option>
                                                }
                                            </select>
                                        </div>

                                        <div class="layer w-100 mB-15">
                                            <label asp-for="Steps" class="form-label fw-600">
                                                <i class="ti-list mR-5"></i> YapÄ±lÄ±ÅŸ *
                                            </label>
                                            <div style="margin-top:22px;"></div>
                                            <div id="stepsEditor"></div>
                                            <textarea asp-for="Steps" id="Steps" name="Steps" class="d-none" required></textarea>
                                            <span asp-validation-for="Steps" class="text-danger fsz-sm"></span>
                                        </div>

                                        <div class="layer w-100 mB-15">
                                            <label class="form-label fw-600 mB-8">
                                                <i class="ti-image mR-5"></i> Tarif GÃ¶rselleri
                                            </label>
                                            <small class="c-grey-600 d-block mB-10">Birden Ã§ok fotoÄŸraf ekleyebilirsiniz. Birini ana fotoÄŸraf olarak seÃ§ebilirsiniz.</small>
                                            
                                            <!-- Yeni gÃ¶rsel ekleme -->
                                            <div class="mB-10">
                                                <input type="file" name="imageFiles" id="imageFiles" accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" class="form-control" multiple />
                                                <small class="c-grey-600 d-block mT-5">JPG, PNG, GIF veya WebP formatÄ±nda, maksimum 5MB (birden Ã§ok seÃ§ebilirsiniz)</small>
                                            </div>
                                            
                                            <!-- URL ile ekleme -->
                                            <div class="mB-10">
                                                <div class="d-flex gap-10 ai-c" style="flex-wrap: wrap;">
                                                    <input type="text" id="imageUrlInput" class="form-control" placeholder="https://example.com/image.jpg" style="flex: 1; min-width: 200px;" />
                                                    <button type="button" id="addImageUrl" class="btn btn-sm btn-outline-primary">
                                                        <i class="ti-plus"></i> URL Ekle
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <!-- Yeni eklenen gÃ¶rseller listesi -->
                                            <div id="newImagesList" class="mT-15">
                                                <!-- Yeni gÃ¶rseller buraya eklenecek -->
                                            </div>
                                            
                                            <!-- Hidden inputs -->
                                            <input type="hidden" id="imageUrlsJson" name="imageUrlsJson" />
                                            <input type="hidden" id="primaryImageIndex" name="primaryImageIndex" value="0" />
                                            <input type="hidden" id="removedImageIds" name="removedImageIds" />
                                        </div>
                                        <div class="layer w-100 mB-15">
                                            <label asp-for="AlternativeIngredients" class="form-label fw-600">
                                                <i class="ti-exchange-vertical mR-5"></i> Alternatif Malzemeler
                                            </label>
                                            <textarea asp-for="AlternativeIngredients" class="form-control" rows="3"
                                                      placeholder="Alternatif malzemeler"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                                <div class="row mT-20">
                                    <div class="bd-top pT-15">
                                        <div class="peers fxw-nw gap-10" style="justify-content: flex-end;">
                                            <div class="peer">
                                                <button type="submit" class="btn btn-primary" style="color: white;">
                                                    <i class="ti-save mR-5"></i> Kaydet
                                                </button>
                                            </div>
                                            <div class="peer">
                                                <a asp-controller="Recipes" asp-action="Index" class="btn btn-secondary" style="color: white;">
                                                    <i class="ti-close mR-5"></i> Ä°ptal
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <partial name="_ValidationScriptsPartial" />
        <script>
            // Mevcut gÃ¶rselleri window'a set et (recipe-form.js iÃ§in) - Create sayfasÄ±nda boÅŸ
            window.existingImagesData = [];
        </script>
        <script src="~/js/recipe-form.js"></script>
    }
</div>
