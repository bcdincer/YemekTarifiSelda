@model IEnumerable<FrontendMvc.Models.Recipes.RecipeViewModel>

@{
    ViewData["Title"] = "Ana Sayfa";
    ViewData["Description"] = "En lezzetli yemek tarifleri, pratik yemekler, tatlı tarifleri ve daha fazlası. Binlerce tarif arasından seçim yapın ve lezzetli yemekler pişirin.";
    ViewData["Keywords"] = "yemek tarifleri, yemek, tarif, yemek kitabı, pratik yemek, tatlı tarifi, pasta tarifi, kolay yemek";
    var categories = ViewBag.Categories as List<FrontendMvc.Models.Recipes.CategoryViewModel> ?? new();
    var pagedResult = ViewBag.PagedResult as FrontendMvc.Models.Recipes.PagedResult<FrontendMvc.Models.Recipes.RecipeViewModel>;
    var hasSearch = !string.IsNullOrWhiteSpace(ViewBag.SearchTerm as string);
}

@if (hasSearch)
{
    <!-- Arama Sonuçları Sayfası -->
    <div class="row gap-20">
        <!-- Sol Sidebar - Filtreler -->
        <div class="col-lg-3 col-md-4">
            <div class="bd bgc-white filter-panel-container" style="position: sticky; top: 20px; display: flex; flex-direction: column; height: calc(100vh - 40px); max-height: calc(100vh - 40px);">
                <h5 class="filter-panel-header" style="padding: 20px 20px 0 20px; margin-bottom: 20px; flex-shrink: 0;">
                    <i class="ti-filter mR-8"></i> Filtrele
                </h5>
                
                <form asp-controller="Home" asp-action="Index" method="get" id="filterForm" style="display: flex; flex-direction: column; flex: 1; min-height: 0; overflow: hidden; position: relative;">
                    <!-- Filtre Butonları - Üstte, her zaman görünür -->
                    <div class="filter-panel-buttons" style="padding: 0 20px 20px 20px; flex-shrink: 0; background-color: white; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary w-100" style="color: white;">
                            <i class="ti-search mR-5"></i> Filtrele
                        </button>
                        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary w-100 mT-10">
                            <i class="ti-reload mR-5"></i> Filtreleri Temizle
                        </a>
                    </div>
                    
                    <div class="filter-panel-content" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 20px; min-height: 0; max-height: 100%;">
                    <!-- Arama Kelimesi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Arama Kelimesi</label>
                        <input type="text" name="search" class="form-control" placeholder="Tarif ara..." value="@ViewBag.SearchTerm">
                    </div>

                    <!-- Kategori Filtresi -->
                    @if (categories.Any())
                    {
                        <div class="form-group mB-20">
                            <label class="fw-600 mB-8">Kategori</label>
                            <select name="categoryId" class="form-control">
                                <option value="">Tüm Kategoriler</option>
                                @foreach (var category in categories.OrderBy(c => c.DisplayOrder).ThenBy(c => c.Name))
                                {
                                    if (ViewBag.CategoryId == category.Id)
                                    {
                                        <option value="@category.Id" selected>@category.Name</option>
                                    }
                                    else
                                    {
                                        <option value="@category.Id">@category.Name</option>
                                    }
                                }
                            </select>
                        </div>
                    }

                    <!-- Zorluk Seviyesi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Zorluk Seviyesi</label>
                        <select name="difficulty" class="form-control">
                            <option value="">Tümü</option>
                            @if (ViewBag.Difficulty == "Kolay")
                            {
                                <option value="Kolay" selected>Kolay</option>
                            }
                            else
                            {
                                <option value="Kolay">Kolay</option>
                            }
                            @if (ViewBag.Difficulty == "Orta")
                            {
                                <option value="Orta" selected>Orta</option>
                            }
                            else
                            {
                                <option value="Orta">Orta</option>
                            }
                            @if (ViewBag.Difficulty == "Zor")
                            {
                                <option value="Zor" selected>Zor</option>
                            }
                            else
                            {
                                <option value="Zor">Zor</option>
                            }
                        </select>
                    </div>

                    <!-- Hazırlık Süresi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Maksimum Hazırlık Süresi (dk)</label>
                        <input type="number" name="maxPrepTime" class="form-control" placeholder="örn: 30" value="@ViewBag.MaxPrepTime" min="1">
                    </div>

                    <!-- Pişirme Süresi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Maksimum Pişirme Süresi (dk)</label>
                        <input type="number" name="maxCookingTime" class="form-control" placeholder="örn: 60" value="@ViewBag.MaxCookingTime" min="1">
                    </div>

                    <!-- Toplam Süre -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Maksimum Toplam Süre (dk)</label>
                        <input type="number" name="maxTotalTime" class="form-control" placeholder="örn: 90" value="@ViewBag.MaxTotalTime" min="1">
                    </div>

                    <!-- Porsiyon Sayısı -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Porsiyon Sayısı</label>
                        <div class="d-flex" style="gap: 8px;">
                            <input type="number" name="minServings" class="form-control" placeholder="Min" value="@ViewBag.MinServings" min="1" style="flex: 1;">
                            <span style="line-height: 38px;">-</span>
                            <input type="number" name="maxServings" class="form-control" placeholder="Max" value="@ViewBag.MaxServings" min="1" style="flex: 1;">
                        </div>
                    </div>

                    <!-- Malzeme Filtresi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Malzeme İçeren Tarifler</label>
                        <input type="text" name="ingredient" class="form-control" placeholder="örn: domates, soğan..." value="@ViewBag.Ingredient">
                    </div>

                    <!-- Alerjen Filtresi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Hariç Tutulacak Malzemeler (Alerjenler)</label>
                        <input type="text" name="excludedIngredients" class="form-control" placeholder="örn: fıstık, gluten..." value="@(ViewBag.ExcludedIngredients != null ? string.Join(", ", ViewBag.ExcludedIngredients) : "")">
                        <small class="form-text text-muted">Virgülle ayırarak birden fazla malzeme girebilirsiniz</small>
                    </div>

                    <!-- Diyet Tipi -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Diyet Tipi</label>
                        <select name="dietType" class="form-control">
                            <option value="">Tümü</option>
                            @if (ViewBag.DietType == "vegan")
                            {
                                <option value="vegan" selected>Vegan</option>
                            }
                            else
                            {
                                <option value="vegan">Vegan</option>
                            }
                            @if (ViewBag.DietType == "vegetarian")
                            {
                                <option value="vegetarian" selected>Vejetaryen</option>
                            }
                            else
                            {
                                <option value="vegetarian">Vejetaryen</option>
                            }
                            @if (ViewBag.DietType == "gluten-free")
                            {
                                <option value="gluten-free" selected>Glütensiz</option>
                            }
                            else
                            {
                                <option value="gluten-free">Glütensiz</option>
                            }
                            @if (ViewBag.DietType == "dairy-free")
                            {
                                <option value="dairy-free" selected>Süt Ürünleri Yok</option>
                            }
                            else
                            {
                                <option value="dairy-free">Süt Ürünleri Yok</option>
                            }
                            @if (ViewBag.DietType == "nut-free")
                            {
                                <option value="nut-free" selected>Kuruyemiş Yok</option>
                            }
                            else
                            {
                                <option value="nut-free">Kuruyemiş Yok</option>
                            }
                        </select>
                    </div>

                    <!-- Minimum Puan -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Minimum Puan</label>
                        <select name="minRating" class="form-control">
                            <option value="">Tümü</option>
                            @if (ViewBag.MinRating != null && (double)ViewBag.MinRating == 4.0)
                            {
                                <option value="4.0" selected>4.0 ve üzeri</option>
                            }
                            else
                            {
                                <option value="4.0">4.0 ve üzeri</option>
                            }
                            @if (ViewBag.MinRating != null && (double)ViewBag.MinRating == 4.5)
                            {
                                <option value="4.5" selected>4.5 ve üzeri</option>
                            }
                            else
                            {
                                <option value="4.5">4.5 ve üzeri</option>
                            }
                            @if (ViewBag.MinRating != null && (double)ViewBag.MinRating == 3.0)
                            {
                                <option value="3.0" selected>3.0 ve üzeri</option>
                            }
                            else
                            {
                                <option value="3.0">3.0 ve üzeri</option>
                            }
                        </select>
                    </div>

                    <!-- Minimum Puan Sayısı -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Minimum Puan Sayısı</label>
                        <input type="number" name="minRatingCount" class="form-control" placeholder="örn: 5" value="@ViewBag.MinRatingCount" min="1">
                    </div>

                    <!-- Öne Çıkan Tarifler -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">
                            @if (ViewBag.IsFeatured == true)
                            {
                                <input type="checkbox" name="isFeatured" value="true" checked style="margin-right: 8px;">
                            }
                            else
                            {
                                <input type="checkbox" name="isFeatured" value="true" style="margin-right: 8px;">
                            }
                            Sadece Öne Çıkan Tarifler
                        </label>
                    </div>

                    <!-- Sıralama -->
                    <div class="form-group mB-20">
                        <label class="fw-600 mB-8">Sıralama</label>
                        <select name="sortBy" class="form-control">
                            @if (ViewBag.SortBy == "newest" || ViewBag.SortBy == null)
                            {
                                <option value="newest" selected>En Yeni</option>
                            }
                            else
                            {
                                <option value="newest">En Yeni</option>
                            }
                            @if (ViewBag.SortBy == "rating")
                            {
                                <option value="rating" selected>En Yüksek Puan</option>
                            }
                            else
                            {
                                <option value="rating">En Yüksek Puan</option>
                            }
                            @if (ViewBag.SortBy == "likes")
                            {
                                <option value="likes" selected>En Çok Beğenilen</option>
                            }
                            else
                            {
                                <option value="likes">En Çok Beğenilen</option>
                            }
                            @if (ViewBag.SortBy == "views")
                            {
                                <option value="views" selected>En Çok Görüntülenen</option>
                            }
                            else
                            {
                                <option value="views">En Çok Görüntülenen</option>
                            }
                            @if (ViewBag.SortBy == "prepTime")
                            {
                                <option value="prepTime" selected>Hazırlık Süresine Göre</option>
                            }
                            else
                            {
                                <option value="prepTime">Hazırlık Süresine Göre</option>
                            }
                            @if (ViewBag.SortBy == "cookingTime")
                            {
                                <option value="cookingTime" selected>Pişirme Süresine Göre</option>
                            }
                            else
                            {
                                <option value="cookingTime">Pişirme Süresine Göre</option>
                            }
                            @if (ViewBag.SortBy == "totaltime")
                            {
                                <option value="totaltime" selected>Toplam Süreye Göre</option>
                            }
                            else
                            {
                                <option value="totaltime">Toplam Süreye Göre</option>
                            }
                        </select>
                    </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Ana İçerik Alanı -->
        <div class="col-lg-9 col-md-8">
            <!-- Arama Sonuçları Başlığı -->
            <div class="bd bgc-white p-20 mB-20">
                <h4 class="mB-15">
                    <i class="ti-search mR-10"></i>
                    "@ViewBag.SearchTerm" araması için 
                    @if (pagedResult != null)
                    {
                        <span>@pagedResult.TotalCount sonuç bulundu.</span>
                    }
                </h4>

                <!-- Aktif Arama Filtresi -->
                @if (!string.IsNullOrWhiteSpace(ViewBag.SearchTerm as string))
                {
                    <div class="d-flex gap-10 fxw-w">
                        <div class="bd bgc-grey-100 p-8 bdrs-3" style="display: flex; align-items: center; gap: 8px;">
                            <span class="fw-600" style="font-size: 12px; color: #666;">Arama Kelimesi:</span>
                            <span style="font-size: 14px;">@ViewBag.SearchTerm</span>
                            <a href="@Url.Action("Index", "Home", new { categoryId = ViewBag.CategoryId, sortBy = ViewBag.SortBy })" 
                               class="c-grey-600 cH-red td-n" style="margin-left: 5px;">
                                <i class="ti-close" style="font-size: 14px;"></i>
                            </a>
                        </div>
                    </div>
                }
            </div>

            <!-- Sıralama Seçenekleri -->
            <div class="bd bgc-white p-20 mB-20">
                <div class="sort-buttons-container">
                    <a href="@Url.Action("Index", "Home", new { categoryId = ViewBag.CategoryId, search = ViewBag.SearchTerm, sortBy = (string)null })" 
                       class="sort-btn @(ViewBag.SortBy == null || ViewBag.SortBy == "" ? "sort-btn-active" : "")">
                        <i class="ti-layout-grid2"></i>
                        <span>Akıllı Sıralama</span>
                    </a>
                    <a href="@Url.Action("Index", "Home", new { categoryId = ViewBag.CategoryId, search = ViewBag.SearchTerm, sortBy = "newest" })" 
                       class="sort-btn @(ViewBag.SortBy == "newest" ? "sort-btn-active" : "")">
                        <i class="ti-calendar"></i>
                        <span>Tarihe Göre</span>
                    </a>
                    <a href="@Url.Action("Index", "Home", new { categoryId = ViewBag.CategoryId, search = ViewBag.SearchTerm, sortBy = "rating" })" 
                       class="sort-btn @(ViewBag.SortBy == "rating" ? "sort-btn-active" : "")">
                        <i class="ti-star"></i>
                        <span>En Yüksek Puan</span>
                    </a>
                    <a href="@Url.Action("Index", "Home", new { categoryId = ViewBag.CategoryId, search = ViewBag.SearchTerm, sortBy = "likes" })" 
                       class="sort-btn @(ViewBag.SortBy == "likes" ? "sort-btn-active" : "")">
                        <i class="ti-heart"></i>
                        <span>En Çok Beğenilen</span>
                    </a>
                </div>
            </div>

            <!-- Tarifler Listesi -->
            @if (!Model.Any())
            {
                <div class="bd bgc-white p-30 ta-c">
                    <h5 class="c-grey-600">Tarif bulunamadı</h5>
                    <p class="c-grey-500 mT-10">Arama kriterlerinizi değiştirerek tekrar deneyin.</p>
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <a asp-controller="Recipes" asp-action="Create" class="btn btn-primary mT-20" style="color: white;">
                            <i class="ti-plus"></i> İlk Tarifi Ekle
                        </a>
                    }
                </div>
            }
            else
            {
                <div class="row gap-20">
                    @foreach (var recipe in Model)
                    {
                        <div class="col-md-6 col-lg-3 mb-3">
                            <a asp-controller="Recipes" asp-action="Details" asp-route-id="@recipe.Id" class="recipe-card-link" style="text-decoration: none; display: block; height: 100%;">
                                <div class="bd bgc-white bdrs-3 ov-h recipe-card" style="transition: all 0.3s ease; cursor: pointer; display: flex; flex-direction: column; height: 100%;">
                                    @if (!string.IsNullOrEmpty(recipe.ImageUrl))
                                    {
                                        <div class="recipe-card-image-wrapper" style="position: relative; overflow: hidden;">
                                            <img src="@recipe.ImageUrl" alt="@recipe.Title" class="w-100" style="height: 200px; object-fit: cover; transition: transform 0.3s ease;" loading="lazy" decoding="async">
                                            <div class="recipe-card-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: flex-end; padding: 15px;">
                                                <span class="c-white fw-600" style="font-size: 14px;">
                                                    <i class="ti-eye mR-5"></i> Detayları Gör
                                                </span>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="w-100 bgc-grey-200" style="height: 200px; display: flex; align-items: center; justify-content: center; position: relative;">
                                            <i class="ti-image fsz-xxl c-grey-400"></i>
                                            <div class="recipe-card-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                                                <span class="c-white fw-600">
                                                    <i class="ti-eye mR-5"></i> Detayları Gör
                                                </span>
                                            </div>
                                        </div>
                                    }
                                    <div class="p-20" style="flex: 1; display: flex; flex-direction: column;">
                                        <h6 class="mB-10 c-grey-800" style="transition: color 0.3s ease; min-height: 48px; line-height: 1.4;">
                                            @recipe.Title
                                        </h6>
                                        <p class="fsz-sm c-grey-600 mB-10" style="min-height: 40px; line-height: 1.4;">
                                            @(recipe.Description.Length > 100 ? recipe.Description.Substring(0, 100) + "..." : recipe.Description)
                                        </p>
                                        <div class="peers fxw-nw ai-c fsz-sm c-grey-600 mB-10" style="min-height: 24px; flex-shrink: 0;">
                                            <div class="peer mR-15">
                                                <i class="ti-time"></i> @recipe.CookingTimeMinutes dk
                                            </div>
                                            <div class="peer mR-15">
                                                <i class="ti-user"></i> @recipe.Servings kişilik
                                            </div>
                                            @if (recipe.Category != null)
                                            {
                                                <div class="peer">
                                                    <i class="@recipe.Category.Icon"></i> @recipe.Category.Name
                                                </div>
                                            }
                                        </div>
                                        <div class="peers fxw-nw ai-c mT-10 gap-10" style="min-height: 32px; flex-shrink: 0; margin-top: auto; align-items: center;">
                                            <div class="peer" style="min-width: 120px;">
                                                @if (recipe.AverageRating.HasValue)
                                                {
                                                    <div class="peers fxw-nw ai-c">
                                                        <div class="peer" style="display: inline-flex; align-items: center; gap: 2px;">
                                                            @{
                                                                double visualRating = recipe.AverageRating.Value * 2; // 1-5 -> 2-10
                                                            }
                                                            @for (int i = 0; i < 5; i++)
                                                            {
                                                                int starValue = (i + 1) * 2; // 2, 4, 6, 8, 10
                                                                int starStart = i * 2; // 0, 2, 4, 6, 8
                                                                
                                                                if (visualRating >= starValue)
                                                                {
                                                                    <i class="ti-star c-yellow-500" style="font-size: 14px;"></i>
                                                                }
                                                                else if (visualRating > starStart && visualRating < starValue)
                                                                {
                                                                    double fractionalPart = (visualRating - starStart) / (starValue - starStart);
                                                                    double fillPercentage = fractionalPart * 100;
                                                                    <div style="position: relative; display: inline-block; width: 14px; height: 14px; line-height: 1;">
                                                                        <i class="ti-star c-grey-300" style="font-size: 14px; position: absolute; left: 0; top: 0; z-index: 1;"></i>
                                                                        <div style="position: absolute; left: 0; top: 0; width: @(fillPercentage.ToString("F1", System.Globalization.CultureInfo.InvariantCulture))%; height: 14px; overflow: hidden; z-index: 2;">
                                                                            <i class="ti-star c-yellow-500" style="font-size: 14px; position: absolute; left: 0; top: 0; width: 14px; height: 14px; display: block;"></i>
                                                                        </div>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <i class="ti-star c-grey-300" style="font-size: 14px;"></i>
                                                                }
                                                            }
                                                        </div>
                                                        <div class="peer mL-5 fsz-sm c-grey-600">
                                                            <span class="fw-600">@recipe.AverageRating.Value.ToString("F1")</span> (@recipe.RatingCount)
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                            <div class="peer" style="min-width: 50px;">
                                                @if (recipe.LikeCount > 0)
                                                {
                                                    <i class="ti-heart c-red-500"></i>
                                                    <span class="fsz-sm c-grey-600 mL-3">@recipe.LikeCount</span>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>

                <!-- Pagination -->
                @if (pagedResult != null && pagedResult.TotalPages > 1)
                {
                    <div class="bd bgc-white p-20 mT-20">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center mB-0">
                                <li class="page-item @(pagedResult.HasPreviousPage ? "" : "disabled")">
                                    <a class="page-link" asp-controller="Home" asp-action="Index" 
                                       asp-route-pageNumber="@(pagedResult.PageNumber - 1)"
                                       asp-route-pageSize="@pagedResult.PageSize"
                                       asp-route-categoryId="@ViewBag.CategoryId"
                                       asp-route-search="@ViewBag.SearchTerm"
                                       asp-route-sortBy="@ViewBag.SortBy"
                                       asp-route-difficulty="@ViewBag.Difficulty"
                                       asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                       asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                       asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                       asp-route-minServings="@ViewBag.MinServings"
                                       asp-route-maxServings="@ViewBag.MaxServings"
                                       asp-route-ingredient="@ViewBag.Ingredient"
                                       asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                       asp-route-dietType="@ViewBag.DietType"
                                       asp-route-isFeatured="@ViewBag.IsFeatured"
                                       asp-route-minRating="@ViewBag.MinRating"
                                       asp-route-minRatingCount="@ViewBag.MinRatingCount">Önceki</a>
                                </li>
                                @for (int i = 1; i <= pagedResult.TotalPages; i++)
                                {
                                    <li class="page-item @(i == pagedResult.PageNumber ? "active" : "")">
                                        <a class="page-link" asp-controller="Home" asp-action="Index" 
                                           asp-route-pageNumber="@i"
                                           asp-route-pageSize="@pagedResult.PageSize"
                                           asp-route-categoryId="@ViewBag.CategoryId"
                                           asp-route-search="@ViewBag.SearchTerm"
                                           asp-route-sortBy="@ViewBag.SortBy"
                                           asp-route-difficulty="@ViewBag.Difficulty"
                                           asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                           asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                           asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                           asp-route-minServings="@ViewBag.MinServings"
                                           asp-route-maxServings="@ViewBag.MaxServings"
                                           asp-route-ingredient="@ViewBag.Ingredient"
                                           asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                           asp-route-dietType="@ViewBag.DietType"
                                           asp-route-isFeatured="@ViewBag.IsFeatured"
                                           asp-route-minRating="@ViewBag.MinRating"
                                           asp-route-minRatingCount="@ViewBag.MinRatingCount">@i</a>
                                    </li>
                                }
                                <li class="page-item @(pagedResult.HasNextPage ? "" : "disabled")">
                                    <a class="page-link" asp-controller="Home" asp-action="Index" 
                                       asp-route-pageNumber="@(pagedResult.PageNumber + 1)"
                                       asp-route-pageSize="@pagedResult.PageSize"
                                       asp-route-categoryId="@ViewBag.CategoryId"
                                       asp-route-search="@ViewBag.SearchTerm"
                                       asp-route-sortBy="@ViewBag.SortBy"
                                       asp-route-difficulty="@ViewBag.Difficulty"
                                       asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                       asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                       asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                       asp-route-minServings="@ViewBag.MinServings"
                                       asp-route-maxServings="@ViewBag.MaxServings"
                                       asp-route-ingredient="@ViewBag.Ingredient"
                                       asp-route-isFeatured="@ViewBag.IsFeatured"
                                       asp-route-minRating="@ViewBag.MinRating"
                                       asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                       asp-route-dietType="@ViewBag.DietType"
                                       asp-route-minRatingCount="@ViewBag.MinRatingCount">Sonraki</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            }
        </div>
    </div>
}
else
{
    <!-- Ana Sayfa (Arama yoksa) -->
    <div class="row gap-20">
        <!-- Başlık ve Filtreler -->
        <div class="col-12">
            <div class="bd bgc-white p-20">
                <div class="layers">
                    <div class="layer w-100 mB-20">
                        <div class="peers fxw-nw ai-c">
                            <div class="peer peer-greed">
                                <h4 class="lh-1 mB-0">Tarifler</h4>
                            </div>                            
                        </div>
                    </div>
                    
                    <!-- Arama -->
                    <div class="layer w-100">
                        <form asp-controller="Home" asp-action="Index" method="get" id="searchForm">
                            @if (ViewBag.CategoryId != null)
                            {
                                <input type="hidden" name="categoryId" value="@ViewBag.CategoryId">
                            }
                            <div class="d-flex" style="gap: 8px;">
                                <div class="search-input-wrapper" style="flex: 1; position: relative;">
                                    <i class="ti-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 18px; pointer-events: none;"></i>
                                    <input type="text" name="search" id="searchInput" class="form-control" placeholder="Tarif adı veya malzeme ara..." value="@ViewBag.SearchTerm" style="padding-left: 45px;">
                                </div>
                                <button type="submit" class="btn btn-primary" style="color: white; white-space: nowrap; padding: 8px 20px;">
                                    <i class="ti-search mR-5"></i> Ara
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarifler Listesi -->
        @if (!Model.Any())
        {
            <div class="col-12">
                <div class="bd bgc-white p-30 ta-c">
                    <h5 class="c-grey-600">Tarif bulunamadı</h5>
                    <p class="c-grey-500 mT-10">Arama kriterlerinizi değiştirerek tekrar deneyin.</p>
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <a asp-controller="Recipes" asp-action="Create" class="btn btn-primary mT-20" style="color: white;">
                            <i class="ti-plus"></i> Yeni Tarif Ekle
                        </a>
                    }
                </div>
            </div>
        }
        else
        {
            @foreach (var recipe in Model)
            {
                <div class="col-md-6 col-lg-3 mb-3">
                    <a asp-controller="Recipes" asp-action="Details" asp-route-id="@recipe.Id" class="recipe-card-link" style="text-decoration: none; display: block; height: 100%;">
                        <div class="bd bgc-white bdrs-3 ov-h recipe-card" style="transition: all 0.3s ease; cursor: pointer; display: flex; flex-direction: column; height: 100%;">
                            @if (!string.IsNullOrEmpty(recipe.ImageUrl))
                            {
                                <div class="recipe-card-image-wrapper" style="position: relative; overflow: hidden;">
                                    <img src="@recipe.ImageUrl" alt="@recipe.Title" class="w-100" style="height: 200px; object-fit: cover; transition: transform 0.3s ease;" loading="lazy" decoding="async">
                                    <div class="recipe-card-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: flex-end; padding: 15px;">
                                        <span class="c-white fw-600" style="font-size: 14px;">
                                            <i class="ti-eye mR-5"></i> Detayları Gör
                                        </span>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="w-100 bgc-grey-200" style="height: 200px; display: flex; align-items: center; justify-content: center; position: relative;">
                                    <i class="ti-image fsz-xxl c-grey-400"></i>
                                    <div class="recipe-card-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                                        <span class="c-white fw-600">
                                            <i class="ti-eye mR-5"></i> Detayları Gör
                                        </span>
                                    </div>
                                </div>
                            }
                            <div class="p-20" style="flex: 1; display: flex; flex-direction: column;">
                                <h6 class="mB-10 c-grey-800" style="transition: color 0.3s ease; min-height: 48px; line-height: 1.4;">
                                    @recipe.Title
                                </h6>
                                <p class="fsz-sm c-grey-600 mB-10" style="min-height: 40px; line-height: 1.4;">
                                    @(recipe.Description.Length > 100 ? recipe.Description.Substring(0, 100) + "..." : recipe.Description)
                                </p>
                                <div class="peers fxw-nw ai-c fsz-sm c-grey-600 mB-10" style="min-height: 24px; flex-shrink: 0;">
                                    <div class="peer mR-15">
                                        <i class="ti-time"></i> @recipe.CookingTimeMinutes dk
                                    </div>
                                    <div class="peer mR-15">
                                        <i class="ti-user"></i> @recipe.Servings kişilik
                                    </div>
                                    @if (recipe.Category != null)
                                    {
                                        <div class="peer">
                                            <i class="@recipe.Category.Icon"></i> @recipe.Category.Name
                                        </div>
                                    }
                                </div>
                                <div class="peers fxw-nw ai-c mT-10 gap-10" style="min-height: 32px; flex-shrink: 0; margin-top: auto; align-items: center;">
                                    <div class="peer" style="min-width: 120px;">
                                        @if (recipe.AverageRating.HasValue)
                                        {
                                            <div class="peers fxw-nw ai-c">
                                                <div class="peer" style="display: inline-flex; align-items: center; gap: 2px;">
                                                    @{
                                                        double visualRating2 = recipe.AverageRating.Value * 2; // 1-5 -> 2-10
                                                    }
                                                    @for (int i = 0; i < 5; i++)
                                                    {
                                                        int starValue = (i + 1) * 2; // 2, 4, 6, 8, 10
                                                        int starStart = i * 2; // 0, 2, 4, 6, 8
                                                        
                                                        if (visualRating2 >= starValue)
                                                        {
                                                            <i class="ti-star c-yellow-500" style="font-size: 14px;"></i>
                                                        }
                                                        else if (visualRating2 > starStart && visualRating2 < starValue)
                                                        {
                                                            double fractionalPart = (visualRating2 - starStart) / (starValue - starStart);
                                                            double fillPercentage = fractionalPart * 100;
                                                            <div style="position: relative; display: inline-block; width: 14px; height: 14px; line-height: 1;">
                                                                <i class="ti-star c-grey-300" style="font-size: 14px; position: absolute; left: 0; top: 0; z-index: 1;"></i>
                                                                <div style="position: absolute; left: 0; top: 0; width: @(fillPercentage.ToString("F1", System.Globalization.CultureInfo.InvariantCulture))%; height: 14px; overflow: hidden; z-index: 2;">
                                                                    <i class="ti-star c-yellow-500" style="font-size: 14px; position: absolute; left: 0; top: 0; width: 14px; height: 14px; display: block;"></i>
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <i class="ti-star c-grey-300" style="font-size: 14px;"></i>
                                                        }
                                                    }
                                                </div>
                                                <div class="peer mL-5 fsz-sm c-grey-600">
                                                    <span class="fw-600">@recipe.AverageRating.Value.ToString("F1")</span> (@recipe.RatingCount)
                                                </div>
                                            </div>
                                        }
                                    </div>
                                    <div class="peer" style="min-width: 50px;">
                                        @if (recipe.LikeCount > 0)
                                        {
                                            <i class="ti-heart c-red-500"></i>
                                            <span class="fsz-sm c-grey-600 mL-3">@recipe.LikeCount</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            }

            <!-- Pagination -->
            @if (pagedResult != null && pagedResult.TotalPages > 1)
            {
                <div class="col-12">
                    <div class="bd bgc-white p-20">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center mB-0">
                                <li class="page-item @(pagedResult.HasPreviousPage ? "" : "disabled")">
                                    <a class="page-link" asp-controller="Home" asp-action="Index" 
                                       asp-route-pageNumber="@(pagedResult.PageNumber - 1)"
                                       asp-route-pageSize="@pagedResult.PageSize"
                                       asp-route-categoryId="@ViewBag.CategoryId"
                                       asp-route-search="@ViewBag.SearchTerm"
                                       asp-route-sortBy="@ViewBag.SortBy"
                                       asp-route-difficulty="@ViewBag.Difficulty"
                                       asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                       asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                       asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                       asp-route-minServings="@ViewBag.MinServings"
                                       asp-route-maxServings="@ViewBag.MaxServings"
                                       asp-route-ingredient="@ViewBag.Ingredient"
                                       asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                       asp-route-dietType="@ViewBag.DietType"
                                       asp-route-isFeatured="@ViewBag.IsFeatured"
                                       asp-route-minRating="@ViewBag.MinRating"
                                       asp-route-minRatingCount="@ViewBag.MinRatingCount">Önceki</a>
                                </li>
                                @for (int i = 1; i <= pagedResult.TotalPages; i++)
                                {
                                    <li class="page-item @(i == pagedResult.PageNumber ? "active" : "")">
                                        <a class="page-link" asp-controller="Home" asp-action="Index" 
                                           asp-route-pageNumber="@i"
                                           asp-route-pageSize="@pagedResult.PageSize"
                                           asp-route-categoryId="@ViewBag.CategoryId"
                                           asp-route-search="@ViewBag.SearchTerm"
                                           asp-route-sortBy="@ViewBag.SortBy"
                                           asp-route-difficulty="@ViewBag.Difficulty"
                                           asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                           asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                           asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                           asp-route-minServings="@ViewBag.MinServings"
                                           asp-route-maxServings="@ViewBag.MaxServings"
                                           asp-route-ingredient="@ViewBag.Ingredient"
                                           asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                           asp-route-dietType="@ViewBag.DietType"
                                           asp-route-isFeatured="@ViewBag.IsFeatured"
                                           asp-route-minRating="@ViewBag.MinRating"
                                           asp-route-minRatingCount="@ViewBag.MinRatingCount">@i</a>
                                    </li>
                                }
                                <li class="page-item @(pagedResult.HasNextPage ? "" : "disabled")">
                                    <a class="page-link" asp-controller="Home" asp-action="Index" 
                                       asp-route-pageNumber="@(pagedResult.PageNumber + 1)"
                                       asp-route-pageSize="@pagedResult.PageSize"
                                       asp-route-categoryId="@ViewBag.CategoryId"
                                       asp-route-search="@ViewBag.SearchTerm"
                                       asp-route-sortBy="@ViewBag.SortBy"
                                       asp-route-difficulty="@ViewBag.Difficulty"
                                       asp-route-maxPrepTime="@ViewBag.MaxPrepTime"
                                       asp-route-maxCookingTime="@ViewBag.MaxCookingTime"
                                       asp-route-maxTotalTime="@ViewBag.MaxTotalTime"
                                       asp-route-minServings="@ViewBag.MinServings"
                                       asp-route-maxServings="@ViewBag.MaxServings"
                                       asp-route-ingredient="@ViewBag.Ingredient"
                                       asp-route-isFeatured="@ViewBag.IsFeatured"
                                       asp-route-minRating="@ViewBag.MinRating"
                                       asp-route-excludedIngredients="@ViewBag.ExcludedIngredients"
                                       asp-route-dietType="@ViewBag.DietType"
                                       asp-route-minRatingCount="@ViewBag.MinRatingCount">Sonraki</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            }
        }
    </div>
}

<style>
    /* Recipe Card Hover Effects */
    .recipe-card-link {
        text-decoration: none !important;
    }
    
    .recipe-card {
        transition: all 0.3s ease;
    }
    
    .recipe-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
    }
    
    .recipe-card:hover .recipe-card-image-wrapper img {
        transform: scale(1.05);
    }
    
    .recipe-card:hover .recipe-card-overlay {
        opacity: 1 !important;
    }
    
    .recipe-card:hover h6 {
        color: #007bff !important;
    }
    
    /* Sort Buttons Styling */
    .sort-buttons-container {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
    }
    
    .sort-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 500;
        text-decoration: none;
        border-radius: 8px;
        border: 2px solid var(--c-border, #e0e0e0);
        background-color: var(--c-bkg-card, #fff);
        color: var(--c-text-base, #333);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .sort-btn i {
        font-size: 16px;
        transition: transform 0.3s ease;
    }
    
    .sort-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-color: var(--c-primary, #007bff);
        background-color: var(--c-bkg-card, #fff);
    }
    
    .sort-btn:hover i {
        transform: scale(1.1);
    }
    
    .sort-btn-active {
        background-color: var(--c-primary, #007bff) !important;
        border-color: var(--c-primary, #007bff) !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }
    
    .sort-btn-active:hover {
        background-color: var(--c-primary, #007bff) !important;
        border-color: var(--c-primary, #007bff) !important;
        color: #fff !important;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);
    }
    
    /* Dark mode support */
    [data-theme="dark"] .sort-btn {
        background-color: var(--c-bkg-card) !important;
        border-color: var(--c-border) !important;
        color: var(--c-text-base) !important;
    }
    
    [data-theme="dark"] .sort-btn:hover {
        border-color: var(--c-primary) !important;
        background-color: var(--c-bkg-body) !important;
    }
    
    [data-theme="dark"] .sort-btn-active {
        background-color: var(--c-primary) !important;
        border-color: var(--c-primary) !important;
        color: #fff !important;
    }
    
    /* Responsive */
    @@media (max-width: 576px) {
        .sort-buttons-container {
            gap: 8px;
        }
        
        .sort-btn {
            padding: 8px 16px;
            font-size: 13px;
            flex: 1;
            min-width: calc(50% - 4px);
            justify-content: center;
        }
    }
    
    /* Filtre Panel Stilleri */
    .filter-panel-container {
        border-radius: 8px;
        /* Butonların her zaman görünür olması için minimum yükseklik */
        min-height: 400px;
    }
    
    .filter-panel-content {
        /* Scroll bar için padding */
        padding-right: 10px !important;
        /* Minimum yükseklik yok, flex ile genişleyecek */
    }
    
    .filter-panel-content::-webkit-scrollbar {
        width: 8px;
    }
    
    .filter-panel-content::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .filter-panel-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
    
    .filter-panel-content::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    
    .filter-panel-buttons {
        flex-shrink: 0;
        z-index: 10;
        /* Butonlar üstte, her zaman görünür */
        position: relative;
        width: 100%;
    }
    
    /* Form içeriğinin scroll edilebilir alanını butonların üstünde tut */
    #filterForm {
        display: flex !important;
        flex-direction: column !important;
    }
    
    #filterForm .filter-panel-content {
        flex: 1 1 auto !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
    }
    
    #filterForm .filter-panel-buttons {
        flex: 0 0 auto !important;
    }
    
    /* Dark mode desteği */
    [data-theme="dark"] .filter-panel-container {
        background-color: var(--c-bkg-card) !important;
        border-color: var(--c-border) !important;
    }
    
    [data-theme="dark"] .filter-panel-buttons {
        background-color: var(--c-bkg-card) !important;
        border-bottom-color: var(--c-border) !important;
    }
    
    [data-theme="dark"] .filter-panel-content::-webkit-scrollbar-track {
        background: var(--c-bkg-body);
    }
    
    [data-theme="dark"] .filter-panel-content::-webkit-scrollbar-thumb {
        background: var(--c-border);
    }
    
    [data-theme="dark"] .filter-panel-content::-webkit-scrollbar-thumb:hover {
        background: var(--c-text-muted);
    }
</style>

@section Scripts {
    <script>
        // Submit form on Enter key
        const searchInput = document.getElementById('searchInput');
        const searchForm = document.getElementById('searchForm');
        if (searchInput && searchForm) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchForm.submit();
                }
            });
        }
    </script>
}
